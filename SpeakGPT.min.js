!function(){window.__myBookmarkletObserver&&(window.__myBookmarkletObserver.disconnect(),console.log("Deactivating prior instance of the bookmarklet"));var s=".prose > *",r=[],i=!1;let f="";function u(e){f+=" "+e;var o=window.speechSynthesis,t=(o.cancel(),console.log("Stopping any ongoing speech instances"),new SpeechSynthesisUtterance(e));t.rate=1.1,t.voice=(()=>{var o,e=window.speechSynthesis.getVoices();for(o of["Google UK English Female","Google UK English Male","Fiona","Moira","Alex","Daniel","Melina","Tessa","Karen","Rocko","Ralph","Moira","Organ","Cellos","Jester","Bells","Trinoids","Google US English","en-US"]){var t=e.find(e=>e.lang.match(/^en/)&&e.name===o);if(t)return console.log("Chose Voice: "+o),t}return e[0]})(),console.log("Starting to speak:",e),o.speak(t)}var e,l=()=>{if(console.log(),!i&&0!==r.length){i=!0;var o,{text:t,element:n,version:s}=r[0];let e=!1;n.parentElement||(e=!0,console.log("[Skipping]: Weirdo, no parent element"+n.innerText)),e?(i=!1,r.shift(),l()):n.__version!==s?(console.log("Older version: "+s+", final one is: "+n.__version),r.shift(),i=!1,l()):(!n.__shortWaited||n.__shortWaited<3)&&t.length<30?(console.log("Too Short, wait a second... ["+t+"]"),console.log(n),console.log(n.parentElement),n.__shortWaited=n.__shortWaited?n.__shortWaited+1:1,setTimeout(()=>{console.log("Now, Keep Speaking..."),i=!1,l()},1e3)):function(e){var n=/(\b\w+\b)\W*$/,o=/^\W*(\b\w+\b)/,t=f.match(n),s=t?t[1].toLowerCase():null;if(!s||-1===e.indexOf(s))return console.log(`Speaking ALL text (first time, or last spoken word [${s}] is not in text): `+e),u(e),!0;var r,i=[],l=[s];let a=f.slice(0,f.length-t[0].length),c=!1,d=e;for(;null!==(r=o.exec(d));){var h=r[1].toLowerCase();if(i.push(h),d=d.slice(r[0].length+1),h==s){let t=!1;var p=[...l];for(let o=0;a.match(/\w/)&&o<i.length;o++){let e=p.shift();if(void 0===e){var g=a.match(n),_=g?g[1].toLowerCase():null;if(!_)break;l.push(_),e=_,a=a.slice(0,a.length-g[0].length)}if(e!=i[i.length-1-o]){t=!0;break}}if(!t){c=!0;break}}}return c?!!d.match(/\w/)&&(console.log("Speaking Partial text: "+d),u(d),!0):(console.log("Speaking ALL text: "+e),u(e),!0)}(t)?(o=()=>{window.speechSynthesis.speaking||window.speechSynthesis.pending?setTimeout(o,100):(console.log("Done Speaking: "+r.length+" items left in queue"),i=!1,r.shift(),n.__read=!0,l())},setTimeout(o,100)):(console.log("[SKIPPING ]Non-Repeat filter says this has already been completely been said: "+t),i=!1,r.shift(),n.__read=!0,l())}},a=(e,o,t)=>{o.__read||(r.push({text:e,element:o,version:t}),l())},c=e=>{var o,t,n;e.closest(".prose")&&(o=(e=e).innerText,"pre"===e.tagName.toLowerCase()&&(o="skip, code block here."),t=void 0===e.__version?0:e.__version,e.__version=t+1,a(o,e,t+1),n=e,new MutationObserver(e=>{e.forEach(e=>{"childList"===e.type&&0<e.addedNodes.length&&e.addedNodes.forEach(e=>{e.nodeType===Node.TEXT_NODE?d(n):e.nodeType===Node.ELEMENT_NODE&&(e.matches(s)?[e]:e.querySelectorAll(s)).forEach(e=>{c(e)})}),"characterData"===e.type&&d(n)})}).observe(n,{childList:!0,subtree:!0,characterData:!0}))},d=e=>{console.log("Changed element detected:",e);var o=e.innerText,t=("pre"===e.tagName.toLowerCase()&&(o="skip, code block here."),void 0===e.__version?0:e.__version);e.__version=t+1,e.__read=!1,a(o,e,t+1)},o=new MutationObserver(e=>{e.forEach(e=>{"childList"===e.type&&0<e.addedNodes.length&&e.addedNodes.forEach(e=>{e.nodeType===Node.ELEMENT_NODE&&(e.matches(s)?[e]:e.querySelectorAll(s)).forEach(e=>{c(e)})})})});function t(){window.speechSynthesis.cancel(),r=[]}o.observe(document.body,{childList:!0,subtree:!0}),window.currentStopButton&&(e=window.currentStopButton)&&e.parentNode&&e.parentNode.removeChild(e),window.currentStopButton=((e=document.createElement("button")).textContent="Stop",e.style.color="red",e.style.position="fixed",e.style.right="10px",e.style.top="50%",e.style.zIndex=1e3,e.style.backgroundColor="#fff",e.style.border="1px solid #000",e.style.borderRadius="4px",e.style.padding="4px 8px",e.style.fontSize="14px",e.style.cursor="pointer",e.addEventListener("click",t),document.body.appendChild(e),e),setTimeout(()=>{u("Speak GPT now enabled")},500),window.__myBookmarkletObserver=o}();